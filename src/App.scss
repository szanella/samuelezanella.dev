@import 'assets/scss/colours';

$aspect-ratio: 1/2;
$transition-stagger: 0.05s;
$transition-duration: 0.5s;
$intro-transition-duration: 0.25s;

:root {
  --full-height: calc(var(--vh, 1vh) * 100);
  --shards-container-height: calc(var(--vh, 1vh) * 90);
  --caption-heading-height: calc(var(--vh, 1vh) * 10);
  --caption-body-height: calc(var(--vh, 1vh) * 90);
}

@mixin shards-disappeared {
  .shards-container {
    .shard-wrap {
      &:nth-child(1) .shard,
      &:nth-child(2) .shard,
      &:nth-child(6) .shard,
      &:nth-child(11) .shard {
        background-color: rgb(0, 0, 0);
        clip-path: polygon(50% 50%, 50% 50%, 50% 50%, 50% 50%);
      }

      &:nth-child(3) .shard,
      &:nth-child(4) .shard,
      &:nth-child(5) .shard,
      &:nth-child(8) .shard,
      &:nth-child(9) .shard,
      &:nth-child(10) .shard {
        background-color: rgb(0, 0, 0);
        clip-path: circle(0% at 50% 50%);
      }

      &:nth-child(7) .shard {
        background-color: rgb(0, 0, 0);
        clip-path: polygon(50% 50%, 50% 50%, 50% 50%);
      }
    }
  }
}

@mixin shards-raised {
  .shards-container {
    .shard-wrap {

      @for $i from 1 through 11 {
        &:nth-child(#{$i}) .shard {
          background-color: rgba(224, 224, 224, 0);
          $x: 50vw;
          $y: 0;
          @if $i == 1 or $i == 2 or $i == 6 or $i == 11 {
            clip-path: polygon($x $y, $x $y, $x $y, $x $y);
          } @else if $i == 3 or $i == 4 or $i == 5 or $i == 8 or $i == 9 or $i == 10 {
            clip-path: circle(0% at $x $y);
          } @else {
            clip-path: polygon($x $y, $x $y, $x $y);
          }
          transition-delay: 0ms;
        }
      }
    }
  }
}

// Window
$window-width: 85%;
$window-height: 85%;
$y-offset: -5%;

@mixin window-header($header-h, $flip) {
  $x1: (100% - $window-width) / 2;
  $x2: 100% - $x1;
  $y1: (100% - $window-height) / 2 + $y-offset;
  $y2: $y1 + $header-h;
  @if $flip == true {
    clip-path: polygon($x1 $y1, $x1 $y2, $x2 $y2, $x2 $y1);
  } @else {
    clip-path: polygon($x1 $y1, $x2 $y1, $x2 $y2, $x1 $y2);
  }
}

@mixin window-body($header-h, $flip) {
  $x1: (100% - $window-width) / 2;
  $x2: 100% - $x1;
  $y1: (100% - $window-height) / 2  + $header-h + $y-offset;
  $y2: 100% - (100% - $window-height) / 2 + $y-offset;
  @if $flip == true {
    clip-path: polygon($x1 $y1, $x1 $y2, $x2 $y2, $x2 $y1);
  } @else {
    clip-path: polygon($x1 $y1, $x2 $y1, $x2 $y2, $x1 $y2);
  }
}

// Backend
$terminal-bar-height: 3.5%;
$terminal-button-radius: 0.65%;
$terminal-button-margin: 0.2%;
$terminal-cursor-width: 1%;
$terminal-cursor-height: 4%;

@mixin terminal-button($n) {
  $x1: (100% - $window-width) / 2;
  $y1: (100% - $window-height) / 2 + $y-offset;
  clip-path: circle($terminal-button-radius at ($x1 + ($terminal-button-radius * 2 + $terminal-button-margin) * $n) ($y1 + $terminal-bar-height / 2));
}

// Frontend
$header-height: 6%;
$mouse-start-x: 78%;
$mouse-start-y: 24%;
$mouse-base-coords: (
        x1: 0%,
        y1: 0%,
        x2: 2%,
        y2: 2%,
        x3: 1%,
        y3: 4%
);
$search-bar-height: 4%;
$search-bar-width: 20%;

@function mouse-coords($coords, $x, $y) {
  @return polygon(
                  #{map-get($coords, x1) + $x} #{map-get($coords, y1) + $y},
                  #{map-get($coords, x2) + $x} #{map-get($coords, y2) + $y},
                  #{map-get($coords, x3) + $x} #{map-get($coords, y3) + $y}
  );
}

// AI
@mixin neuron($coords) {
  z-index: 1;

  .shard {
    background-color: rgb(224, 224, 224);
    clip-path: circle(4% at nth($coords, 1) (nth($coords, 2) + $y-offset));
  }
}

@mixin synapse($from, $to) {
  z-index: 0;

  .shard {
    background-color: rgb(0, 0, 0);
    clip-path: polygon(
                    nth($from, 1) nth($from, 2) - 0.5% + $y-offset,
                    nth($to, 1) nth($to, 2) - 0.5% + $y-offset,
                    nth($to, 1) nth($to, 2) + 0.5% + $y-offset,
                    nth($from, 1) nth($from, 2) + 0.5% + $y-offset
    )
  }
}

.app {
  align-items: center;
  display: flex;
  flex-direction: column;
  height: calc(92vh);
  height: var(--full-height);
  justify-content: center;
  outline: none;
  overflow: hidden;
  position: relative;
  transition: background-color $transition-duration ease-in;
  width: 100vw;

  .shards-container {
    height: calc(100vw * #{$aspect-ratio});
    max-height: var(--shards-container-height);
    max-width: 100vw;
    position: absolute;
    width: calc(var(--shards-container-height) / #{$aspect-ratio});

    .shard-wrap {
      background-color: transparent;
      position: absolute;
      height: 100%;
      width: 100%;

      &:nth-child(1),
      &:nth-child(2),
      &:nth-child(6),
      &:nth-child(11) {
        z-index: 0;
      }

      &:nth-child(3),
      &:nth-child(4),
      &:nth-child(5),
      &:nth-child(8),
      &:nth-child(9),
      &:nth-child(10) {
        z-index: 1;
      }

      &:nth-child(7) {
        z-index: 3;
      }

      .shard {
        height: 100%;
        transition-duration: $transition-duration;
        transition-property: background-color, clip-path, opacity;
        transition-timing-function: ease-in-out;
        width: 100%;
      }

      @for $i from 1 through 11 {
        $delay: ($i - 1) * $transition-stagger;
        &:nth-child(#{$i}) .shard {
          transition-delay: $delay;
        }
      }
    }

    .terminal-text {
      color: #FFFFFF;
      font-family: 'Inconsolata', monospace;
      height: 72%;
      left: 9%;
      opacity: 0;
      pointer-events: none;
      position: absolute;
      top: 13% + $y-offset;
      width: 82%;
      z-index: 5;

      p {
        font-size: 2.5vmin;
        line-height: 3.5vmin;
      }
    }
  }

  .intro-text, .contacts {
    pointer-events: none;
    position: absolute;
    z-index: 5;

    > * {
      opacity: 0;
      transition-duration: 100ms;
      transition-property: opacity, transform;
      transition-timing-function: ease-out;
      transform: translateY(75%);
    }
  }

  .intro-text .name {
    color: $tomato;
    margin-bottom: 2vh;
  }

  .tutorial {
    animation: tutorial 1.5s step-end 2 2s, tutorial-fade-out 0.5s ease-out 1 5s;
    animation-fill-mode: forwards;
    bottom: 15%;
    height: auto;
    opacity: 0;
    pointer-events: none;
    position: absolute;
    right: 25%;
    width: calc(var(--vh, 1vh) * 6);

    &.hidden {
      animation: unset;
      opacity: 0;
    }
  }

  &.intro {
    @include shards-disappeared;
    background-color: $linen;

    .intro-text {
      pointer-events: auto;

      .name {
        animation: emphasis 0.5s linear 1 (3.5 * $intro-transition-duration);
      }

      > * {
        opacity: 1;
        transition-duration: $intro-transition-duration;
        transform: translateY(0);
      }

      @for $i from 1 through 4 {
        $delay: $i * $intro-transition-duration;
        > *:nth-child(#{$i}) {
          transition-delay: $delay;
        }
      }
    }
  }

  &.backend {
    &, .caption-text {
      background-color: $gorse;
    }
  }

  &.frontend {
    &, .caption-text {
      background-color: $off-yellow;
    }
  }

  &.ai {
    &, .caption-text {
      background-color: $ghost-white;
    }
  }

  &:not(.caption-expanded) {
    &.backend {
      .shard-wrap {
        &:nth-child(1) .shard {
          background-color: rgb(0, 0, 0);
          @include window-body($terminal-bar-height, false)
        }

        &:nth-child(2) .shard {
          background-color: rgb(63, 61, 60);
          @include window-header($terminal-bar-height, false);
        }

        &:nth-child(3) .shard {
          background-color: rgb(252, 64, 66);
          @include terminal-button(1);
        }

        &:nth-child(4) .shard {
          background-color: rgb(224, 192, 76);
          @include terminal-button(2);
        }

        &:nth-child(5) .shard {
          background-color: rgb(114, 191, 71);
          @include terminal-button(3);
        }

        // Cursor
        &:nth-child(6) .shard {
          //background-color: rgb(240, 240, 240);
          //opacity: 0.75;
          //$x1: (100% - $window-width) / 2 + 1.5%;
          //$y1: (100% - $window-height) / 2  + $terminal-bar-height + 2%;
          //clip-path: polygon(
          //                        ($x1 $y1),
          //                        ($x1 + $terminal-cursor-width) $y1,
          //                        ($x1 + $terminal-cursor-width) ($y1 + $terminal-cursor-height),
          //                        ($x1 ($y1 + $terminal-cursor-height))
          //);
          //
          //animation: cursor-blink 1.5s step-end infinite 0.5s;
          background-color: rgba(0, 0, 0, 0);
          clip-path: polygon(50% 50%, 50% 50%, 50% 50%, 50% 50%);
        }

        &:nth-child(7) .shard {
          background-color: rgb(255, 255, 255);
          clip-path: mouse-coords($mouse-base-coords, 0%, 100%);
        }

        &:nth-child(8) .shard {
          background-color: rgba(0, 0, 0, 0);
          clip-path: circle(0 at 0% 0%);
        }

        &:nth-child(9) .shard {
          background-color: rgba(0, 0, 0, 0);
          clip-path: circle(0 at 0% 50%);
        }

        &:nth-child(10) .shard {
          background-color: rgba(0, 0, 0, 0);
          clip-path: circle(0 at 0% 100%);
        }

        &:nth-child(11) .shard {
          background-color: rgba(0, 0, 0, 0);
          clip-path: polygon(0% 0%, 0% 0%, 0% 0%, 0% 0%);
        }
      }

      .terminal-text {
        opacity: 1;
      }
    }

    &.frontend {
      .shard-wrap {
        &:nth-child(1) .shard {
          //background-color: $cerulean-frost;
          background-color: $wild-blue-yonder;
          @include window-header($header-height, true);
        }

        &:nth-child(2) .shard {
          //background-color: rgb(224, 224, 224);
          background-color: #FFFFFF;
          @include window-body($header-height, true);
        }

        &:nth-child(3) .shard {
          $x1: 100% - (100% - $window-width) / 2 - 3.5%;
          $y1: (100% - $window-height) / 2 + $header-height / 2 + $y-offset;
          background-color: rgb(255, 255, 255);
          clip-path: circle(1.5% at $x1 $y1);

          &:after {
            background-image: url('assets/svg/person.svg');
            background-position: center center;
            background-repeat: no-repeat;
            background-size: 55%;
            content: ' ';
            height: 6%;
            left: $x1 - 1.5%;
            position: absolute;
            top: $y1 - 3%;
            width: 3%;
          }
        }

        &:nth-child(4) .shard {
          $x1: (100% - $window-width) / 2 + 3.5%;
          $y1: (100% - $window-height) / 2 + $header-height / 2 + $y-offset;
          background-color: rgb(255, 255, 255);
          clip-path: circle(1.5% at $x1 $y1);

          &:after {
            background-image: url('assets/svg/whatshot.svg');
            background-position: center center;
            background-repeat: no-repeat;
            background-size: 55%;
            content: ' ';
            height: 6%;
            left: $x1 - 1.5%;
            position: absolute;
            top: $y1 - 3%;
            width: 3%;
          }
        }

        &:nth-child(5) .shard {
          $x: (100% - $window-width) / 2 + 12%;
          $y: (100% - $window-height) / 2 + $header-height + 20% + $y-offset;
          background-color: #FFFFFF;
          clip-path: circle(6% at $x $y);

          &:after {
            background-image: url('assets/svg/person.svg');
            background-position: center center;
            background-repeat: no-repeat;
            background-size: 55%;
            content: ' ';
            height: 24%;
            left: $x - 6%;
            position: absolute;
            top: $y - 12%;
            width: 12%;
          }
        }

        // Search bar
        &:nth-child(6) .shard {
          background-color: rgb(255, 255, 255);
          $x1: (100% - $window-width) / 2 + 8%;
          $y1: (100% - $window-height) / 2 + ($header-height - $search-bar-height) / 2 + $y-offset;
          clip-path: polygon(
                                  ($x1 $y1),
                                  ($x1 + $search-bar-width) $y1,
                                  ($x1 + $search-bar-width) ($y1 + $search-bar-height),
                                  ($x1 ($y1 + $search-bar-height))
          );

          &:after {
            background-image: url('assets/svg/search.svg');
            background-position: center center;
            background-repeat: no-repeat;
            background-size: 60%;
            content: ' ';
            height: $search-bar-height;
            left: $x1 + $search-bar-width - ($search-bar-height / 2);
            position: absolute;
            top: $y1;
            width: $search-bar-height / 2;
          }
        }

        // Mouse
        &:nth-child(7) .shard {
          background-color: rgb(0, 0, 0);
          clip-path: mouse-coords($mouse-base-coords, $mouse-start-x, $mouse-start-y);

          animation: move-around 5s ease-in-out infinite 0.75s;
        }

        &:nth-child(8) .shard {
          background-color: rgba(0, 0, 0, 0);
          clip-path: circle(0 at 0% 0%);
        }

        &:nth-child(9) .shard {
          background-color: rgba(0, 0, 0, 0);
          clip-path: circle(0 at 0% 50%);
        }

        &:nth-child(10) .shard {
          background-color: rgba(0, 0, 0, 0);
          clip-path: circle(0 at 0% 100%);
        }

        &:nth-child(11) .shard {
          background-color: rgb(240, 240, 240);
          $x1: (100% - $window-width) / 2 + 4%;
          $y1: (100% - $window-height) / 2 + $header-height + 8% + $y-offset;
          $x2: $x1 + 16%;
          $y2: $y1 + 40%;
          clip-path: polygon($x1 $y1, $x2 $y1, $x2 $y2, $x1 $y2);
        }
      }
    }

    &.ai {
      .shard-wrap {
        // I3 -> H2 -> O1

        &:nth-child(1) {
          @include synapse(40% 70%, 60% 50%);
        }

        // I1 -> H1 -> O1
        &:nth-child(2) {
          @include synapse(40% 30%, 60% 50%);
        }

        // O1
        &:nth-child(3) {
          @include neuron(60% 50%);
        }

        // H1
        &:nth-child(4) {
          @include neuron(50% 40%);
        }

        // H2
        &:nth-child(5) {
          @include neuron(50% 60%);
        }

        // I2 -> H2
        &:nth-child(6) {
          @include synapse(40% 50%, 50% 60%);
        }

        &:nth-child(7) {
          .shard {
            background-color: rgb(255, 255, 255);
            clip-path: mouse-coords($mouse-base-coords, 0%, 100%);
          }
        }

        // I1
        &:nth-child(8) {
          @include neuron(40% 30%);
        }

        // I2
        &:nth-child(9) {
          @include neuron(40% 50%);
        }

        // I3
        &:nth-child(10) {
          @include neuron(40% 70%);
        }

        // I2 -> H1
        &:nth-child(11) {
          @include synapse(40% 50%, 50% 40%);
        }
      }
    }
  }

  &.frontend.caption-expanded,
  &.backend.caption-expanded,
  &.ai.caption-expanded {
    @include shards-raised;
  }

  .caption {
    align-items: stretch;
    bottom: 0;
    display: flex;
    flex-direction: column;
    height: calc(var(--caption-heading-height) + var(--caption-body-height));
    position: absolute;
    text-align: center;
    transition-duration: #{$transition-duration / 2};
    transition-property: transform;
    transition-timing-function: ease-out;
    user-select: none;
    width: 100vw;
    z-index: 10;

    &.up {
      transform: translateY(var(--caption-body-height));
      transition-delay: #{$transition-duration / 2};
    }

    &.down {
      transform: translateY(115%);
    }

    > * {
      flex: 0;
    }

    &-heading {
      align-items: center;
      box-shadow: rgba(0, 0, 0, 0.3) 0 0 4px 0;
      cursor: pointer;
      display: flex;
      flex: 0 0 var(--caption-heading-height);
      flex-direction: column;
      justify-content: flex-end;
      padding-bottom: calc(var(--vh, 1vh) * 0.75);
      z-index: 2;
    }

    &-arrow {
      align-self: center;
      background-image: url('assets/svg/expand.svg');
      background-position: center;
      background-size: 160%;
      flex: 0 0 auto;
      height: 3vh;
      position: absolute;
      top: 4px;
      transition: transform $transition-duration ease-in;
      width: 3vh;
    }

    &-text {
      opacity: 0;
      padding: 3vh 1.25vh 0;
      transition: opacity #{$transition-duration * 2} ease-out;

      p {
        margin: 1.25vh ;
      }
    }

    &.expanded.up {
      transform: translateY(0);
      transition-timing-function: ease-in;

      .caption-arrow {
        transform: rotateX(180deg);
      }

      .caption-text {
        opacity: 1;
      }
    }
  }

  .caption-overlay {
    background-color: rgba(255, 255, 255, 0);
    height: var(--full-height);
    left: 0;
    opacity: 0;
    pointer-events: none;
    position: fixed;
    top: 0;
    transition: opacity $transition-duration ease-in-out;
    width: 100%;
    z-index: 8;

    &.active {
      opacity: 0.75;
      pointer-events: auto;
    }
  }

  &.contacts {
    @include shards-disappeared;
    background-color: $isabelline;

    .contacts {
      pointer-events: auto;

      > * {
        opacity: 1;
        transition-duration: $intro-transition-duration;
        transform: translateY(0);
      }

      @for $i from 1 through 4 {
        $delay: $i * $intro-transition-duration;
        > *:nth-child(#{$i}) {
          transition-delay: $delay;
        }
      }
    }
  }
}

@keyframes cursor-blink {
  0% {
    opacity: 0.75;
  }
  50% {
    opacity: 0;
  }
  100% {
    opacity: 0.75;
  }
}

@keyframes move-around {
  0% {
    clip-path: mouse-coords($mouse-base-coords, $mouse-start-x, $mouse-start-y);
  }
  8% {
    clip-path: mouse-coords($mouse-base-coords, $mouse-start-x, $mouse-start-y);
  }
  21% {
    clip-path: mouse-coords($mouse-base-coords, $mouse-start-x - 20%, $mouse-start-y + 20%);
  }
  39% {
    clip-path: mouse-coords($mouse-base-coords, $mouse-start-x - 20%, $mouse-start-y + 20%);
  }
  50% {
    clip-path: mouse-coords($mouse-base-coords, $mouse-start-x - 30%, $mouse-start-y + 10%);
  }
  75% {
    clip-path: mouse-coords($mouse-base-coords, $mouse-start-x - 30%, $mouse-start-y + 10%);
  }
  84% {
    clip-path: mouse-coords($mouse-base-coords, $mouse-start-x - 35%, $mouse-start-y + 18%);
  }
  91% {
    clip-path: mouse-coords($mouse-base-coords, $mouse-start-x - 35%, $mouse-start-y + 18%);
  }
  100% {
    clip-path: mouse-coords($mouse-base-coords, $mouse-start-x, $mouse-start-y);
  }
}

@keyframes emphasis {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.03);
  }
  100% {
    transform: scale(1);
  }
}

@keyframes tutorial {
  0% {
    opacity: 1;
    transform: translateY(0);
  }
  15% {
    transform: translateY(-2px);
  }
  30% {
    transform: translateY(0);
  }
  45% {
    transform: translateY(-2px);
  }
  60% {
    transform: translateY(0);
  }
  100% {
    transform: translateY(0);
  }
}

@keyframes tutorial-fade-out {
  0% {
    opacity: 1;
  }
  100% {
    opacity: 0;
  }
}
